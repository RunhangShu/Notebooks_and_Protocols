# 2019 General Notebook

### Author: Andrew D. Nguyen, [Evolutionary Physiologist](https://adnguyen.github.io)      
### Affiliation: University of Florida, Department of Entomology and Nematology      
### Contact: anbe642@gmail.com     

### Date started: 2019-01-01    
### Date end (last modified): ongoing   

<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.    

**Introduction:**    
Notebook for 2019 year. It'll log the rest of my dissertation, post doc projects, meetings, papers I've read, and general project ideas.

## List of projects and description   
* Hsp rxn norm: Understanding how the local thermal environment shapes thermal tolerance and stress response (using Hsps as a proxy for stress) in forest ants of the genus *Aphaenogaster*. CTmax and rxn norm of Hsp expression measured across forest ants from Fl to Maine.   
* Range limits: Identifying the factors/forces that set range limits in common forest ants (*Aphaenogaster picea*). Modelling + measured their cold physiology in forest ants of Maine and Vt.  
* Thermal niche paper: Collaborative paper understanding how the environment shapes the ability to withstand cold and hot temperatures. In field and in a common garden, we measured upper and lower thermal limits of ants from GA-Maine (2 species).    
* Stress in nature: Are ants stressed under experimental warming that projects climate change? Ants were collected from warming chambers (0-5 C increase from ambient) and we measured their stress response.    
* ​Biological rhythms in *Rhagoletis*: Determining the relationship between behavioral rhythms in adult *Rhagoletis* and diapause exit timing + depth(eclosion and mass specific metabolic rate).  
* *Rhagoletis* diapause exit: Determine the physiological parameters that lead to divergent adult emergence patterns between two host races.
* *Rhagoletis cerasi* transcriptome: Determine the adaptive shifts in the transcriptome relating to seasonal timing in low and high altitude populations.  
* Proteome stability project in *Drosophila melanogaster*: Determine the physiological tactics at the molecular level that underlie differences in thermal traits and whether they've been shaped by selection at a broad scale.


# Table of contents (for 200 entries)    
* [Page 1: 2019-01-02](#id-section1). Yearly goals: recap from last year and this year's
* [Page 2: 2019-01-07](#id-section2). lynda.com data tells a great story
* [Page 3: 2019-01-10 ](#id-section3). evolution of Resistance vs tolerance and meeting list with dan
* [Page 4: 2019-01-10 ](#id-section4). Partial correlation code to test out
* [Page 5: 2019-01-15 ](#id-section5). Biological Rhythms project: data note on trikinetics experiment
* [Page 6: 2019-01-17 ](#id-section6). script update for detecting modules with WGCNA
* [Page 7: 2019-01-21 ](#id-section7). paper readings for resistance and tolerance
* [Page 8: 2019-01-24 ](#id-section8). Schneider and Ayres 2008; Nature Review Immunology;
* [Page 9: 2019-01-31 ](#id-section9). test script on hipergator
* [Page 10: 2019-02-05 ](#id-section10). Stem Miner analysis with cerasi data
* [Page 11: 2019-02-11 ](#id-section11). Meeting notes with Dan, 2019-02-08
* [Page 12: 2019-02-13 ](#id-section12). redo analysis with STEM miner with cerasi data; no flybase annotations
* [Page 13: 2019-02-19 ](#id-section13). STEM miner analysis on strength dataset
* [Page 14: 2019-04-19 ](#id-section14). Cerasi/pomonella brain transcriptome project: Organizing ideas
* [Page 15: 2019-05-01 ](#id-section15). Sorting ideas: How do we know the modules we're finding are robust?
* [Page 16:  ](#id-section16).
* [Page 17:  ](#id-section17).
* [Page 18:  ](#id-section18).
* [Page 19:  ](#id-section19).
* [Page 20:  ](#id-section20).
* [Page 21:  ](#id-section21).
* [Page 22:  ](#id-section22).
* [Page 23:  ](#id-section23).
* [Page 24:  ](#id-section24).
* [Page 25:  ](#id-section25).
* [Page 26:  ](#id-section26).
* [Page 27:  ](#id-section27).
* [Page 28:  ](#id-section28).
* [Page 29:  ](#id-section29).
* [Page 30:  ](#id-section30).
* [Page 31:  ](#id-section31).
* [Page 32:  ](#id-section32).
* [Page 33:  ](#id-section33).
* [Page 34:  ](#id-section34).
* [Page 35:  ](#id-section35).
* [Page 36:  ](#id-section36).
* [Page 37:  ](#id-section37).
* [Page 38:  ](#id-section38).
* [Page 39:  ](#id-section39).
* [Page 40:  ](#id-section40).
* [Page 41:  ](#id-section41).
* [Page 42:  ](#id-section42).
* [Page 43:  ](#id-section43).
* [Page 44:  ](#id-section44).
* [Page 45:  ](#id-section45).
* [Page 46:  ](#id-section46).
* [Page 47:  ](#id-section47).
* [Page 48:  ](#id-section48).
* [Page 49:  ](#id-section49).
* [Page 50:  ](#id-section50).
* [Page 51:  ](#id-section51).
* [Page 52:  ](#id-section52).
* [Page 53:  ](#id-section53).
* [Page 54:  ](#id-section54).
* [Page 55:  ](#id-section55).
* [Page 56:  ](#id-section56).
* [Page 57:  ](#id-section57).
* [Page 58:  ](#id-section58).
* [Page 59:  ](#id-section59).
* [Page 60:  ](#id-section60).
* [Page 61:  ](#id-section61).
* [Page 62:  ](#id-section62).
* [Page 63:  ](#id-section63).
* [Page 64:  ](#id-section64).
* [Page 65:  ](#id-section65).
* [Page 66:  ](#id-section66).
* [Page 67:  ](#id-section67).
* [Page 68:  ](#id-section68).
* [Page 69:  ](#id-section69).
* [Page 70:  ](#id-section70).
* [Page 71:  ](#id-section71).
* [Page 72:  ](#id-section72).
* [Page 73:  ](#id-section73).
* [Page 74:  ](#id-section74).
* [Page 75:  ](#id-section75).
* [Page 76:  ](#id-section76).
* [Page 77:  ](#id-section77).
* [Page 78:  ](#id-section78).
* [Page 79:  ](#id-section79).
* [Page 80:  ](#id-section80).
* [Page 81:  ](#id-section81).
* [Page 82:  ](#id-section82).
* [Page 83:  ](#id-section83).
* [Page 84:  ](#id-section84).
* [Page 85:  ](#id-section85).
* [Page 86:  ](#id-section86).
* [Page 87:  ](#id-section87).
* [Page 88:  ](#id-section88).
* [Page 89:  ](#id-section89).
* [Page 90:  ](#id-section90).
* [Page 91:  ](#id-section91).
* [Page 92:  ](#id-section92).
* [Page 93:  ](#id-section93).
* [Page 94:  ](#id-section94).
* [Page 95:  ](#id-section95).
* [Page 96:  ](#id-section96).
* [Page 97:  ](#id-section97).
* [Page 98:  ](#id-section98).
* [Page 99:  ](#id-section99).
* [Page 100:  ](#id-section100).
* [Page 101:  ](#id-section101).
* [Page 102:  ](#id-section102).
* [Page 103:  ](#id-section103).
* [Page 104:  ](#id-section104).
* [Page 105:  ](#id-section105).
* [Page 106:  ](#id-section106).
* [Page 107:  ](#id-section107).
* [Page 108:  ](#id-section108).
* [Page 109:  ](#id-section109).
* [Page 110:  ](#id-section110).
* [Page 111:  ](#id-section111).
* [Page 112:  ](#id-section112).
* [Page 113:  ](#id-section113).
* [Page 114:  ](#id-section114).
* [Page 115:  ](#id-section115).
* [Page 116:  ](#id-section116).
* [Page 117:  ](#id-section117).
* [Page 118:  ](#id-section118).
* [Page 119:  ](#id-section119).
* [Page 120:  ](#id-section120).
* [Page 121:  ](#id-section121).
* [Page 122:  ](#id-section122).
* [Page 123:  ](#id-section123).
* [Page 124:  ](#id-section124).
* [Page 125:  ](#id-section125).
* [Page 126:  ](#id-section126).
* [Page 127:  ](#id-section127).
* [Page 128:  ](#id-section128).
* [Page 129:  ](#id-section129).
* [Page 130:  ](#id-section130).
* [Page 131:  ](#id-section131).
* [Page 132:  ](#id-section132).
* [Page 133:  ](#id-section133).
* [Page 134:  ](#id-section134).
* [Page 135:  ](#id-section135).
* [Page 136:  ](#id-section136).
* [Page 137:  ](#id-section137).
* [Page 138:  ](#id-section138).
* [Page 139:  ](#id-section139).
* [Page 140:  ](#id-section140).
* [Page 141:  ](#id-section141).
* [Page 142:  ](#id-section142).
* [Page 143:  ](#id-section143).
* [Page 144:  ](#id-section144).
* [Page 145:  ](#id-section145).
* [Page 146:  ](#id-section146).
* [Page 147:  ](#id-section147).
* [Page 148:  ](#id-section148).
* [Page 149:  ](#id-section149).
* [Page 150:  ](#id-section150).
* [Page 151:  ](#id-section151).
* [Page 152:  ](#id-section152).
* [Page 153:  ](#id-section153).
* [Page 154:  ](#id-section154).
* [Page 155:  ](#id-section155).
* [Page 156:  ](#id-section156).
* [Page 157:  ](#id-section157).
* [Page 158:  ](#id-section158).
* [Page 159:  ](#id-section159).
* [Page 160:  ](#id-section160).
* [Page 161:  ](#id-section161).
* [Page 162:  ](#id-section162).
* [Page 163:  ](#id-section163).
* [Page 164:  ](#id-section164).
* [Page 165:  ](#id-section165).
* [Page 166:  ](#id-section166).
* [Page 167:  ](#id-section167).
* [Page 168:  ](#id-section168).
* [Page 169:  ](#id-section169).
* [Page 170:  ](#id-section170).
* [Page 171:  ](#id-section171).
* [Page 172:  ](#id-section172).
* [Page 173:  ](#id-section173).
* [Page 174:  ](#id-section174).
* [Page 175:  ](#id-section175).
* [Page 176:  ](#id-section176).
* [Page 177:  ](#id-section177).
* [Page 178:  ](#id-section178).
* [Page 179:  ](#id-section179).
* [Page 180:  ](#id-section180).
* [Page 181:  ](#id-section181).
* [Page 182:  ](#id-section182).
* [Page 183:  ](#id-section183).
* [Page 184:  ](#id-section184).
* [Page 185:  ](#id-section185).
* [Page 186:  ](#id-section186).
* [Page 187:  ](#id-section187).
* [Page 188:  ](#id-section188).
* [Page 189:  ](#id-section189).
* [Page 190:  ](#id-section190).
* [Page 191:  ](#id-section191).
* [Page 192:  ](#id-section192).
* [Page 193:  ](#id-section193).
* [Page 194:  ](#id-section194).
* [Page 195:  ](#id-section195).
* [Page 196:  ](#id-section196).
* [Page 197:  ](#id-section197).
* [Page 198:  ](#id-section198).
* [Page 199:  ](#id-section199).
* [Page 200:  ](#id-section200).



------

<div id='id-section1'/>    

### Page 1:
*2018 year goals**   


1. Submit and publish range limits, hsp rxn norm, and thermal niche papers.    
  * still need to submit revisions for range limit,  end of feb
  * lchick working on thermal niche  
  * SHC and NJG sent me edits to hsp rxn norm  

2. Build a data science course   
  * lost steam on this, didn't do   

3. Solidify meta analysis ideas and start the project  
  * didn't work on this either    

4. Learn and become more proficient at analyzing biological rhythm data; analyze Rhagoletis biological rhythm data to a point where I have a cool story to tell.  
  * learned wavelet analysis and fourier transformations  
  * learned how to estimate biological rhythms,

5. Start working on european cornborers:
	* Learn rearing, diapause biology (induction, termination)
	* experiment on behavioral rhythms  
	* do experiments to understand the molecular basis of behavioral rhythms, specifically focusing on period   

      * didnt have time to start this project    

6. Start constructing a teaching and research statement  
  * started this partly   

7. Apply for and secure external funding  
  * was looking, but didn't find any worth applying to   


**2019 goals**

1. Submit and publish range limits, hsp rxn norm, and thermal niche papers.  

2. I started working on Rhagoletis transcriptome project, so solidfy analysis and publish

3. Finish analysis for Rhagoletis biological rhythms data

4. Anlayze proteome stability data. Learn more bayesian stats in the process to account for measurement error.   

It looks like goals have changed a lot. I think in 2018, I wanted to set myself up more for teaching jobs and start thinking about how to start my own lab. But for this year, I'm going to focus more on publishing.


------

<div id='id-section2'/>    

### Page 2: 2019-01-07 lynda.com data tells a great story    

Story with data - don't need

ex: Andrew Moorefield started company ; could not make payroll ; he let some employees decide

He used 5 numbers to illustrate the dilemma of revenue vs salary.

Story telling technique:

1. Don't give them the answer, walked through the facts - presented with begnning middle and ending.
2. Showed, not telling .
3. Let audience draw on their own conclusions. Done telling the story, pause and let the audience to react  
4. The converse is statement.


Layout:

Context -> conflict -> resolution



Method 2: Discovery Journey Story method

Walk through the ah-ha moment so that the audience can experience it.

Main character - You, not the company . Walk people through the analysis

Typical story line:
1. Recommendations
2. Reasons
3. Evidence

But you need:
1. story
2. Conclusion
3. Reccomendation

Correlation between sales and profits - good correlation for first 20 years or so(), then correlation stopped (1983-2000)

1. he paused and let the audience answer how to explain data
2. answer: mature market (market saturated)


Strategy diff between a developing market vs mature market . Audience just understood this. The audience were then responsive to the recommendations.

Effectiveness: Humans are more passionate about their own ideas than YOUR ideas.

**Let audience struggle with data**-- give audience the gift of discovery



------

What data science tools must you konw?

Proxmox, Hadoop, Spark, and Weka.

Intro:   

Internet of things (Iot) - tons of data becoming interconnected    

Goal: Data fluency - capable of diverse interpretations and creating your own (own what, I have no clue)

Data science : create new information and knowledge ; goal is to provide useful insights for better decisions


You need to know how to do cloud computing.

Build own cloud with ProxMox.


------

<div id='id-section3'/>    

### Page 3: 2019-01-10.  evolution of Resistance vs tolerance and meeting list with dan    

meet with dan:

1. network modules vs time : data too complicated and difficult to interpret. Trying partial correlation , need to scale up the code for each time point and population
2. Review paper on tolerance vs resistance?
3. ANBE goals for this year    
    * Data science positions in academia or industry analyzing genomic data   
    * publish papers


**2019-01-11** meeting with Dan   

We want time ordered to observe the checkered patterns(heat map): We'd expect more proportion early on in time and then less heat later in time in the cross comparisons.  Who falls together early and who doesn't. Know something about the thresholding (more or less stringent is better?) How are clusters being built? Is WGNCA building clusters that is biologically informative?


Suggestion: We want to know what is diff from beginnning to end   

Pairwise diff expression analyses- diff expressed 2 months
**detect modules by grouping them with STEMminer ; group by stat effect , meaning take out population effects and time effect; build networks separately**


check dirrecitonality of evolution; phylogeny of cerasi species


**Meet on monday, create a dream figure** how do we get there? how do we parse the data?

Partial correlation: signs- just add 1 and make everhything on a positive scale !    


****

### Tolerance vs resistance  



# The Evolution of the resistance and tolerance to stress



## Set up: Why we need to understand how organisms cope with stress.

**Inform whether they are resilient or susceptible to environmental change.**

Offsets from ancestral environmental conditions creates mismatches between organism and environment.

Environments can perturb animals, reducing fitness. Specifically, stress damages macromolecules, disrupting cellular activity.



## Problem or Need Statement:

**The way we refer to how organisms cope with stress severely impacts our understanding of the physiological and molecular strategies/tactics of stress hardiness.**

For example: thermal tolerance refers to the ability of an organisms to withstand both low and high temperatures.  However, coping with stress can involve not only tolerance mechanisms, but also resistance.

The field would benefit from the herbivore damage literature.

**Tolerance** - physiological changes in response to environmental perturbations that maintains fitness.

**Resistance** - physiological mechanisms that reduces damage from environmental perturbations.

A big problem in transcriptomic studies: cant tell the difference between resistance vs tolerance -- need reaction norm approach



### Types of Perturbations: Press vs Pulse (Edward Bender 1980)



Press perturbations is consistent damage.

- thermal damage - slow ramping
- performance under herbivore damage
- performance under parasite load



Pulse perturbation is intermittant damage.

- thermal shock, rapid cold/heat treatment - lends itself to investigating recovery mechanisms
- initial herbivore damage
- initial parasite infection

Note: There can be things in between pulse and press: intermediate heat ramping protocols. The central read out for heat damage is proteome stability.



#### Types of patterns to expect from data, pulse or press     

![](https://user-images.githubusercontent.com/4654474/50989224-c7dcae80-14dc-11e9-8071-fa3906cdb8ab.png)



## Evolutionary tactics for stress resistance

Selection favors stress resistance mechanisms when stress is constant throughout a lifetime.

Cost- allocation cost whereby investing in defenses or elevating stress resistant mechanisms comes at the cost of other life history traits such as growth.

Benefit - Takes more stress to disrupt biological activity



Tactics

- High baseline ("Front loading") investment in protective molecules.

## Evolutionary tactics for stress tolerance

Selection favors stress tolerance mechanisms when stress is variable within a lifetime.

Cost- costs energy to turn on a response

Benefit- the response enables the organism to cope with the environmental condition



Tactics

- When perturbed, increase magnitude of protective molecules.

---

---



## Molecular level :

Phenotype: environmental limits (thermal limits, drought limits, )

Resistance - Environmental range where  key macromolecules do not change

Tolerance - Environmental range wherw macromolecules changing during and after



So should we be thinking about what a particular molecule is doing for the organism? THe molecule itself is resistant or tolerant?



Is this just understanding phenotypic plasticity of a given molecule?






------

<div id='id-section4'/>    

### Page 4: 2019-01-10. Partial correlation code to test out

```R
#Andrew Nguyen
#partial correlation matrix

########################################################################
# load libraries

library(ggplot2)
library(data.table)
library(WGCNA)
library(edgeR)
library(tidyr)
library(dplyr)
library(reshape2)
library(igraph)
library("GeneNet")
#library(qgraph)

#load dataset

#myfiles.wide.4<-fread("../Data/CerasiCountsIsos/03_data_set_2018-10-31_wide_filtered_sig_genes.csv")
myfiles.wide.4<-fread("../Data/03_data_set_2018-10-31_wide_filtered_sig_genes.csv")
### Calculate FPKM
table.dge<-DGEList(myfiles.wide.4[,3:43],genes=myfiles.wide.4[,1])
table.dge<- calcNormFactors(table.dge) # running this gives FPKM #https://support.bioconductor.org/p/79379/
tab.fpkm<-rpkm(y=table.dge,gene.length=myfiles.wide.4$Length)
tab.fpkm<-data.frame(tab.fpkm)
tab.fpkm<-data.frame(Name=myfiles.wide.4$Name,tab.fpkm)
tab.fpkm$from<-seq(1,length(tab.fpkm$Name))
#names(tab.fpkm)
#'
#' # Compute Partial Correlations and Select Relevant Edges

#pcor.dyn = ggm.estimate.pcor(t(log2(tab.fpkm[1110:1130,3:6]+1)))
pcor.dyn = ggm.estimate.pcor(t(log2(tab.fpkm[,3:6]+1)))
arth.edges = network.test.edges(pcor.dyn,direct=TRUE,plot=FALSE)
#arth.net = extract.network(arth.edges, method.ggm="number", cutoff.ggm=50)
arth.net = extract.network(arth.edges, method.ggm="number", cutoff.ggm=length(tab.fpkm$Name))
dim(arth.edges)

####
#node.labels = as.character(1:nrow(tab.fpkm))
node.labels = as.character(1:length(tab.fpkm$Name))
gr = network.make.graph(arth.edges, node.labels, drop.singles=FALSE)
#adj<-as(gr,"matrix") # convert graphNEL into adjacency matrix

#convert to igraph
gg<-igraph.from.graphNEL(gr)
################################################
###network node properties
#http://kateto.net/networks-r-igraph
################################################
#density
edge_density(gg) # proportion of present edges from all possible edges in the network

#reciprocity - proportion of reciprocated ties ( for a directed network)
#reciprocity(gg)

##global transivity- ratio of triangles to connected triples (direction disregraded)
#transitivity(gg,type="global")

#diameter: longest geodesic distance (length of shortest parth between two nodes) in a network
#diameter(gg,)

#degree distribution
#deg.dist <- degree_distribution(gg, cumulative=T, mode="all")

## average path length
#mean_distance(gg,directed=TRUE)


### assortativity
#assortativity_degree(gg, directed=T)

#assortativity_nominal(gg,myfiles.wide.4$sig)


################################################
###single node properties
################################################
###local transviity - ratio of triangles to connected triples each vertex is part of
#transitivity(gg, type="local")

###Grab different measures of centrality

################################################
#eigen centrality - proportional to the sum of connection centralities
#eig<-centr_eigen(gg)$vec
#range(eig)
#strength
#st.all<-strength(gg,mode="all",loops=FALSE) # all directions, in and out
st.in<-strength(gg,mode="in",loops=FALSE) # in degree strength
#st.out<-strength(gg,mode="out",loops=FALSE) #out degree

#degree centrality
#d.all<-degree(gg,mode="all"); range(d.all)
d.in<-degree(gg,mode="in")
#d.out<-degree(gg,mode="out")

d<-data.frame(st.in,d.in)
fwrite(d,"2019-01-10_centrality_partial_networks.csv")
#betweeness  

```

running on the hipergator cluster : 04_cluster_script_partial_correlation.sh

```
#!/bin/bash
#SBATCH --job-name=partial_correlation
##SBATCH --mail-user=andrew.nguyen@ufl.edu
##SBATCH --mail-type=ALL
#SBATCH --output=partial_correlation_job-%j.out
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=4
#SBATCH --mem=110gb
#SBATCH --time=96:00:00
#SBATCH --partition=bigmem
#SBATCH --account=dhahn
#SBATCH --qos=dhahn-b
date;hostname;pwd

module load R

cd /ufrc/dhahn/andrew.nguyen/Cerasi_Networks/Script

Rscript 03_2018-12-13_partial_correlation_network_analysis.R

date

```




------

<div id='id-section5'/>    

### Page 5: 2019-01-15. Biological Rhythms project: data note on trikinetics experiment   

Changes are on github, referencing the the commit ---

power outage last night 2019-01-14 saving raw trik data

Andrew Nguyen committed 6fa7221

```
189134	14 Jan 19	18:28:00 (last reading)
1	15 Jan 19	09:22:00 (start reading after power outage)

How to deal with data:
1. just analyze to 2019-14-19 18:28:00 and make sure the flies arent being analyzed for mortality

2. Keep it going and use the Lomb-Scargle method.

We can do both if I keep the flies in the trikinetics set up.
```

------

<div id='id-section6'/>    

### Page 6:  2019-01-17. module detection script update with WGCNA

**Critical changes**
* filtering out category based on statistical significance: genes with only population by time interaction from edgeR model  
* messing with cutheight = 0.15
* messing with module stringency with "deepSplit" specificatin in the cutreeDynamic() function.

```R
########################################################################
# Author: Andrew Nguyen, post doc
# University of Florida
# Hahn lab
# Initiated : 2018-11-29
# Last updated: 2019-01-17

#This script takes a data set that is in wide format, converts it to long,
#then applies a function to estimate network centrality for different subsets fo the data

########################################################################
# load libraries

library(ggplot2)
library(data.table)
library(WGCNA)
library(edgeR)
library(tidyr)
library(dplyr)
library(reshape2)

##############################################################################
#constructing a function to estimate modules of a network for each time point in a
# time series
##############################################################################
### WGNCA
#lets write a fucntion that spits out this output

#d<-tab.fpkm.long%>%
#  dcast(formula=Name~sample,value.var="gxp")


wgcna.mod.det<-function(data=data){
  data<-data%>%
    reshape2::dcast(formula=Name~sample,value.var="gxp")
  adjacency = adjacency(t(data[,-1]), power =1); #adjacency matrix
  #adjacency = adjacency(t(dat.wide[,4:7]), power =1); #adjacency matrix
#topologicla overlap matrix
  TOM = TOMsimilarity(adjacency);
  dissTOM = 1-TOM
  geneTree = hclust(as.dist(dissTOM), method = "average");

#identifying modules using dynamic tree cut
  dynamicMods = cutreeDynamic(dendro = geneTree, distM = dissTOM,
                            deepSplit = 4, pamRespectsDendro = FALSE,
                            minClusterSize = 100);

  dynamicColors = labels2colors(dynamicMods)
  table(dynamicColors)
#calculate eigengenes and then cluster modules eigengenes that are similar
  MEList = moduleEigengenes(t(data[,-1]), colors = dynamicColors)
  #MEList = moduleEigengenes(t(dat.wide[,4:7]), colors = dynamicColors)
  MEs = MEList$eigengenes
  #MEs[is.na(MEs)] <-0
  #MEDiss = 1-cor(MEs);
  #METree = hclust(as.dist(MEDiss), method = "average");
#sizeGrWindow(7, 6)
#plot(METree, main = "Clustering of module eigengenes",
 #    xlab = "", sub = "")
# merge modules?
  merge = mergeCloseModules(t(data[,-1]), dynamicColors, cutHeight =.15, verbose = 3)
  #merge = mergeCloseModules(t(dat.wide[,4:7]), dynamicColors, cutHeight =.25, verbose = 3)
  mergedColors = data.frame(module=as.factor(merge$colors))

  return(mergedColors)
}



##############################################################################
#data parsing start
##############################################################################

### Load data
tab.fpkm.long<-fread("../Data/03_2019-01-15_tab_fpkm.csv")
#tab.fpkm.long<-fread("../Data/01_2018-12-11_testdata_tab.fpkm.long.csv")
tab.fpkm.long<-tab.fpkm.long[,-1]
#log2 transformation to make gxp normal
tab.fpkm.long$gxp<-log2(tab.fpkm.long$gxp+1)


third.dat<-fread("2018-10-25_full_sig_list_edgeR_model.csv",header=TRUE)
third.dat<-third.dat%>%
  select("Name","sig")
tab.fpkm.long<-inner_join(tab.fpkm.long,third.dat,by="Name")
tab.fpkm.long<-tab.fpkm.long%>%
  arrange(sig)
glimpse(tab.fpkm.long)
#head(tab.fpkm.long)
###take mean and std of gxp

tab.fpkm.long.mean<-tab.fpkm.long%>%
  filter(sig=="Pop_int_Time_effect")%>%
  group_by(Name,population,time,sig)%>%
  summarize(gxp.mean=mean(gxp),gxp.sd=sd(gxp))

##############################################################################
#data parsing end
##############################################################################


##############################################################################
#### apply function to whole dataset


#modules<-tab.fpkm.long%>%
#  group_by(population,time)%>%
#  do(wgcna.mod.det(data=.))

modules<-tab.fpkm.long%>%
  filter(sig=="Pop_int_Time_effect")%>%
  group_by(population,time)%>%
  do(wgcna.mod.det(data=.))


nn<-tab.fpkm.long.mean%>%
  filter(sig=="Pop_int_Time_effect")
#modules$Name<-rep(tab.fpkm[1:500,1],10)
#adding back in name column so we can join the datasets with the mean and std dataset
#tab.fpkm.long.mean dataset *
#modules$Name<-rep(unique(tab.fpkm.long[10000,]),10)
#modules$Name<-rep(unique(tab.fpkm.long$Name),10)
modules$Name<-rep(unique(nn$Name),10)

##############################################################################



#joining datasets based on name population and time
data.set<-inner_join(tab.fpkm.long.mean,modules,by=c("Name","population","time"))
# write out the dataset
write.csv(data.set,"05_2019-01-17_WGCNA_time_series_modules_per_timepoint_log2_transformed_point15cutoff.csv")





library(plyr)
#library(rlist)
biglist<-dlply(data.set,.(population,time,module),c()) # create a list from the "data.set"
str(biglist)


#create a list so that we can extract only the Name fromt he list
all_vectors <- list()

for(i in seq_along(biglist)) {
 all_vectors[[i]] <- dplyr::pull(biglist[[i]], Name)
}
names(all_vectors)<-names(biglist) # get the names back to the all_vectors
#str(all_vectors)

#https://codereview.stackexchange.com/questions/17905/compute-intersections-of-all-combinations-of-vectors-in-a-list-of-vectors-in-r/17931#17931
#overlap function
overlap <- function(l) {
  results <- list()
  # Remove duplicates within each entry of l
  l <- lapply(l, unique)

  # combinations of m elements of list l
  for (m in seq(along=l)) {

    # generate and iterate through combinations of length m
    for (indices in combn(seq(length(l)), m, simplify=FALSE)) {

      # make name by concatenating the names of the elements
      # of l that we're intersecting
      name <- paste(names(l)[indices], collapse="_")

      results[[name]] <- Reduce(intersect, l[indices])
    }
  }
  results
}

#getting pariwise comparisons
nms <- combn( names(all_vectors) , 2 , FUN = paste0 , collapse = "-" , simplify = FALSE )

# Make the combinations of list elements
ll <- combn( all_vectors , 2 , simplify = FALSE )

# Intersect the list elements
out <- lapply( ll , function(x) length( intersect( x[[1]] , x[[2]] ) ) )
n<- lapply( all_vectors , function(x) length(x ) )# Output with names
tot<-data.frame(n=unlist(n))
tot$ref_treatment<-rownames(tot)
tot2<-data.frame(n2=unlist(n))
tot2$ref_treatment2<-rownames(tot2)
#tot


###making the dataset for modules
isec.dat<-data.frame(intersection=unlist(setNames( out , nms )))
isec.dat$combo<-rownames(isec.dat)
#isec.dat

isec.dat$ref_treatment<-unlist(lapply(strsplit(isec.dat$combo,split="-"),`[[`,1))
isec.dat$module1<-unlist(lapply(strsplit(isec.dat$ref_treatment,split="\\."),`[[`,3))
isec.dat$population<-unlist(lapply(strsplit(isec.dat$ref_treatment,split="\\."),`[[`,1))
isec.dat$time<-unlist(lapply(strsplit(isec.dat$ref_treatment,split="\\."),`[[`,2))
isec.dat$ref_treatment2<-unlist(lapply(strsplit(isec.dat$combo,split="-"),`[[`,2))


isec.dat<-inner_join(isec.dat,tot,by="ref_treatment")
isec.dat<-inner_join(isec.dat,tot2,by="ref_treatment2")
#head(isec.dat)
isec.dat$prop1<-round(isec.dat$intersection/isec.dat$n,2)
isec.dat$prop2<-round(isec.dat$intersection/isec.dat$n2,2)


write.csv(isec.dat,"05_2019-01-17_modules_intersection_dataset.15cutheight_log2_transformed.csv") # write out dataset
```

------

<div id='id-section7'/>    

### Page 7:  2019-01-21. paper readings for resistance and tolerance    

Evolution of plant resistance and tolerance to frost damage; Ecology letters; Agrawal et al. 2004

Background:  

2 strategies to combat perturbations

Their definitions:

* Resistance : traits that reduce damage
* Tolerance  : traits that reduce the negative fitness impacts of damage   


They studied how a frost event late in the season impacted a 75 parental half sibling family experimental quantitative genetic design in an annual wild radish, southern Ontario.


Big Questions

What types of strategies do plants employ to combat frost damage?

Hypotheses:

They can either mainly resist or tolerate frost damage.

Experimental approach :

Frost damage = newly wilted or dead tissue. Proportion leaf damage were visually estimated on each leaf. Ulatimely transformed into a proportion leaf area damage over entire plant.

Measures of -

* Resistance = 1 - damage
* Tolerance  = for each parental half sib family  as slope of regression between fitness on proportion frost damage.

Main Results

* No trade off in resistance vs tolerance
* Negative correlational selection acting on two traits: selection favored high resistance combined with low tolerance ; low resistance and high tolerance.   

Figure 2. fitness is negatively related to tolerance ; so there is a cost to fitness

Conclusion:

Plants can use both strategies. selection operates on maximizing one while not the other. This could be because there is a trade off between the two mechanisms. However, at the population level, there was no trade off, so it could be that frost damage is rare and this selection event doesn't happen often so that the quantitative genetic architecture may not show the trade off at the population level. Or the two different strategies persist and that is how variation is maintained.




------

EVOLUTIONARY GENETICS OF RESISTANCE AND TOLERANCE TO NATURAL HERBIVORY IN ARABIDOPSIS THALIANA; Evolution; Weinig et al. 2003

Background :

measured resistacne and tolerance to natural apical meristem damage by rabbits in a large field experiment with RILS of arabidopsis. Measured phenological and morphological traits associated with resistance and tolerance

RILs differeed in resistance ( proportion of replicates within a RIL that resisted herbivory)

Resistance  = reduce amount of damage suffered
Tolerance = reducing fitness consequence of damage

They expect a trade-off but empirical evidence shows a mix of results.

Cost of resistance and tolerance may be a way to maintain variation .

Questions:   


* (1) Does a genetic trade-off exist between resistance and tolerance to rabbit herbivory in A. thaliana?
* (2) What are the ecological and developmental mechanisms underlying resistance and tolerance to rabbit her- bivory?
* (3) Is tolerance to rabbit herbivory costly in the ab- sence of damage?  
* (4) What is the pattern of natural selection acting on resistance and tolerance in this species, and how sensitive are those patterns to the mean level of resistance and tolerance exhibited by the population?

Experimental approach:

Resistance to AMD = 1 -p ; p is the proportion of individuals that suffered AMD.
Tolerance = We operationally defined tolerance for each RIL as (WD 􏰄- WU), the difference between mean relative fitness of plants with AMD and those without AMD

One issue they ran into: no herbivore exclusion treatment to serve as control.

Results:

Resistance and Tolerance were uncorrelated .

Effect of AMD on phenotypic traits:

* AMD increased branch production, lowered average height of basal branches, and led to later time to senescence.

------

Numbering the hairs on our heads: The shared challenge and promise of phenomics; PNAS; Houle 2009

medicine and evolution share a common theme in that they both try to understand the genotype-phenotype map.

It is easy to measure genomes, but it is harder to measure all phenotypes.  

Imbalance between G space (genotypes) and P space (phenotype space)




------

Phenomics: the next challenge; Nature Genetics; Houle et al.

> We now define phenomics as the acquisition of high-dimensional phenotypic data on an organism-wide scale

Or...All of the different characteristics of an organism.


Justification of studying:

* trace causal links between genotypes and environmental facts and phenotypes.
  * G-P map.   
    * metaphor in which genotypic information influences the phenotype of an organism
    * Jim Burns in 1970 proposed linking population genetic data with biochemical variation
    *
  * Pleiotropy- how a gene affects multiple phenotypes.    
* Genetic basis of complex traits  
  * Gwas studies- try to gauge hwo much genetic variance there is on traits   
  * predict disease,
* Causal explanation of phenotypes   
  * we dont know which traits are important, but if we measure a bunch of them, we can determine that
  *

### Goals and Technical challenges   

2 ways to be more comprehensive:

1. sample a wide variety of phenotypes - phenotyping   
2. define extensive phenotyping as chracterizing a phenotype in great detail   

* Sample gene expression in a tissue through time   
* increase quantitative information by phenotype measures

Data challenges   

* Overfitting the data: Too many variables that outnumber sample size ; large p, small N problem
* Dimension reduction of phenotypes - pca, discriminant analysis
* Ridge and LASSO regressions, fit models without dimension reduction int he case of large p, small N
  * model complexity is penalized with cross validation   
* dimension reduction can discard information
* use machine learning techniques like random forests, regression tree

Causally cohesive models

G-P maps extend across all biological levels of organization and are highly non-linear.

Dynmic models can account for hierarchy, space, and time between genetic variation and phenotypes. ex: tooth shape in mammals.

Phenomic tools:

* Transcriptome and Epigenome.

* Proteomics and metabolics.  

* behavior   

* Imaging

basically measure stuff at different levels of organization  



------

<div id='id-section8'/>    

### Page 8:  2019-01-24. Schneider and Ayres 2008; Nature Review Immunology;

Title: Two ways to survive infection, what resistance and tolerance can teach us about treating infectious diseases


**Overall, they argue that resistance is well known, but tolerance is less well known**

### Intro

definitions :

resistance - ability to limit pathogen burden
tolerance - ability to limit the health impact of a given pathogen burden


* Tolerance includes all mechanisms that regulate the self-harm that can be caused by an immunse response (aka bystander damage or immunopathology) and other mechanisms not directly related to immune resistance.

* Host's defense capacity = resistance + tolerance

* Well-known : molecular mechanisms that kill pathoges, prevent infection   

* less well-known: how hosts regulate production, repair, and avoidance of damage that accumulates during infection

* Big picture - understanding this stuff ( resistance and tolerance of pathogen damage) will inform treatment and diagnosis of diseases.   


### resistance and tolerance in plants   

* two-component defense response originated in plant literature .

* Displayed with reaction norms of fitness against environmental gradient.   
    * env gradient can be pathogen, damage induced by pathogen, pathogen load, other host response , actual number of pathogens in host   


* resistance defined as inverse of parasite burden **Does this make sense**?
  * when resistance increases, pathogen load will decrease   

* tolerance is measured by the slope of the reaction norm - the more flat the slope, the more tolerant (host)    

* idea of tolerance is under-represented in vertebrate immunology   


### What are mechanisms of tolerance  ?     

* people know how to describe resistance mechanisms:
  * immune recognition
  * production of effectors , interaction with immune cells
  * **How does a pathogen cause damage?** What is the read out? Does the pathogen just take resources from the host? It take up space? It doesn't let the host operate optimally?
  * frame issues in terms of how a mechanism impacts tolerance/resistnace
    * consider mechanism that affects tolerance if it impacts the slope of the tolerance curve  
    * assuming this is the same for resistance

**Class one:**

* effector molecules that induce resistance mechanims that cause self harm and result in decrease in tolerance  
* resistance and tolerance are opposite
* ex- ROS produced during immune response are important for fighting infection, but can cause immunopathology and lead to death (decreasing tolerance)    
* Selection favors less toxic effectors and receptos in the immune response; hosts have less toxic efefctors (i dont get this)   
* seelction for receptors that triggure immune responses (Toll-like receptors ) - high affinity of receptors for pathogen-associated molecules than for self molecules.
* Take home - the thing that lowers pathogen load (some effector) can decrease tolerance due to self harm.   

**Class two**   

* regulators of both resistance and tolerance
* typically signalling molecules

**Class three**

* Tolerance and resistance can be separated : 5 examples
  * touting as the best type of mechanism for finding new drugs and treatments that modulate tolerance  
  1. immune response to infection - toxic compounds produced by pathogen must be dealt with to prevent damage to host  
  2. resistance can be energetically expensive. Fruit flies alter energy use and wasting of body when infected by mycobacterium due to decreased tolerance.
  3. preventing physiological damage can affect tolerance. immune responses can induce physiological changes that are deleterious for some organs. Sepsis can induce fatal chagnes in cardiovascular phys
  4. Repair mechanisms: if pathology cannot be prevented, then they must repair tissue damage.
  5. genetic traits that increase  defenses against malaria.   


### Tolerance mechanisms in invertebrates    

* typically measure pathogen load or antimicrobial activity represent effects of infection on host fitness
* IMD ( toll and immune deficiency ) signalling pathways in fruit flies.
* no correlation between bacterial titres(resistance) and survival. Genotypes with lowest titres were not necessarily the healthiest ; proceeses other than resistance are used (but if they are already infected, they could already be perturbed) ;

**They keep referring to tolerance mechanisms but it really is unclear what the hell they're talking about** They're not matching the molecular processes with the framing they had earlier on. For example, they're not walking the reader through how different molecular mechanisms can increase the slope of the relationship between fitness and damage.  Very unclear.    

### Tolerance properties in vertebrate models    

* Ex: plasmodium chabaudi ; Råberg et al. applied stat framework of reaction norms by plant ecologists to vertebrate model. Infected 5 strains of mice with plasmodium and tested 3 different clones of plasmodium
  * measured host health by severity of anaemia and weight loss in infected mice ; plotted against peak parasite density(parasite burden) . Variation in resistance between strains
  * the slopes of the reaction norms (tolerance ) also differed among strains
  * negative correlation between tolerance and resistance
* tick- lyme disease example ; mouse model gets arthritis
* molecular mechanism example: mice that are dificient in a specific ATP-sensitive potassium channel was found to be more sensitive to LPS--they'd get heart attacks when challenged to it
  * viral infection in K_ATP deficient mice had low cytokine production and abrupt death. The hypothesized mode of action was that the KATP channel prevents vasoconstriction in the arteries of the heart.
  * argued as a tolerance mechanism that prevents damage


### Tolerance properties in humans   

* Malaria example


### Studying tolerance systematically    

* argues to broaden perspective  
* can broaden with genetic screens
  * some mutant deaths correlates wtih bacterial burden -defects in resistance
  * other mutant deaths had comparable levels of bacteria to wild type flies ; defective in tolerance
  * future screens need to categorize reistance vs tolerance and have gain and loss of function mutations
* genetics only part of story-- test different pathogens

### Medicine and Tolerance    

* manipulate tolerance mechanisms - administer corticosteroids in combo with antibiotics to decrease risk of mortality and hearing loss
* determine a person's reaction norm


------

<div id='id-section9'/>    

### Page 9:  2019-01-31. test script on hipergator    

```
#!/bin/bash
#SBATCH --job-name=Test_R_script
##SBATCH --mail-user=andrew.nguyen@ufl.edu
#SBATCH --mail-type=ALL
#SBATCH --output my_job-%j.out
#SBATCH --nodes=4
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=4
#SBATCH --mem=120gb
#SBATCH --time=72:00:00


date;hostname;pwd

module load R


cd /home/andrew.nguyen/Cerasi_Networks/Script

Rscript 03_test.R

```



------

<div id='id-section10'/>    

### Page 10:  2019-02-05. Stem Miner analysis with cerasi data     


Using STEM-miner [http://www.cs.cmu.edu/~jernst/stem/](http://www.cs.cmu.edu/~jernst/stem/) to identify clusters of gene expression through time for highland and lowland cerasi populations  
* [paper](https://bmcbioinformatics.biomedcentral.com/articles/10.1186/1471-2105-7-191)    


It is a GUI based program, so I'll need to log what I'm doing here    


### Settings

* Log normalized data
* Gene annotation source = flybase for Drosophila melanogaster
* Maximum number of model profiles = 100  

I want to try to identify as many clusters as possible


### Dataset  

Sample data set, where you need the gene ID (using flybase ids for genes) and then the columsn are the different gxp values with different times) . Gxp is already log2 normalized.

```
Gene       2M_0       2_5M        3_5M       4M_0       4_5M
1 FBgn0027495,FBgn0033633,FBgn0036282,FBgn0033427  1.7700410  1.9639728  1.76863459  1.8877797  1.7986530
2                                     FBgn0037941 -0.5193285 -0.1164224 -0.33351716 -0.3594560 -0.4406869
3                                     FBgn0263782  0.8824218  0.8587433  0.69634484  0.7132860  0.7337638
4                                     FBgn0043854 -0.5152793 -0.4016565 -0.34947210 -0.2898082 -0.2252473
5                                     FBgn0262534 -0.5271620  0.0638229 -0.04790487 -0.5071678 -0.1017322
6                                                 -0.3525314 -0.5961887 -0.29617612 -0.8444862 -0.4384412

```

### Approach  

* get results from Highland
* get results from lowland
* compare highland (reference) with lowland


### Results

* get results from Highland   

sig cluster IDs : 95, 73, 92, 38, 93, 17, 30, 90

![](https://user-images.githubusercontent.com/4654474/52297424-b3aa9680-294e-11e9-9671-3ee25220ff59.png)

* compare highland (reference) with lowland   

high 73: low 58, 63, 89
high 83: low 89
high 92: low 89
high 95: low 37, 63, 86, 89

![](https://user-images.githubusercontent.com/4654474/52297428-b4dbc380-294e-11e9-9e8f-e1665e3f7b8e.png)

* get results from lowland


47, 89, 63, 58, 44, 79, 81, 41, 53, 39, 13, 86, 87, 38, 32, 18, 43

![](https://user-images.githubusercontent.com/4654474/52297531-f5d3d800-294e-11e9-814d-7a6b5189507a.png)


* compare lowland (reference) with highland      

![](https://user-images.githubusercontent.com/4654474/52298040-08024600-2950-11e9-9119-8c664c9f8086.png)


------

<div id='id-section11'/>    

### Page 11:  2019-02-11. Meeting notes with Dan, 2019-02-08  

Met with Dan and showed the results from STEM-MINER.

Dan's thoughts

* What are the genes?
* integrate data into the flyer interactome -- which ones are actual hubs and not hubs from those data? Does it match up ?
* Next step: we have gxp vs time, try clustering based on strength vs time.  
  * Hubs - gxp has some pattern, strength matches pattern or is consistently high (always hubs)
  * Effectors (downstream?): - gxp has some pattern ; strength always low throughout time


------

<div id='id-section12'/>    

### Page 12: 2019-02-13. redo analysis with STEM miner with cerasi data; no flybase annotations

**Problem with previous analysis**: When I tried to match up the names with the larger annotation file that has flybase IDs, the data shrunk for some reason. So for this run, I'm just taking the genes without the flybase gene IDs. It has 13,857 genes.

Parameters: 100 profiles, no annotations, normalized data option


* The top part is High profile.
* The middle part is Low profile
* bottom part is the comparison

![](https://user-images.githubusercontent.com/4654474/52742892-cfddb180-2fa6-11e9-84c2-8a313ce8088e.png)

**Result**: The profiles look overall the same.

------

<div id='id-section13'/>    

### Page 13: 2019-02-19.  STEM miner analysis on strength dataset

THe data: We have the strength (sum of weights of the edges into a given node, aka, gene in this case) of each gene across 5 time points and for 2 different populations

We want to know how sets of genes significantly cluster in their pattern through time.

To calculate strength, we simply calculated the sum of the rows (or columns) of an adjacency matrix (estimated for each time point and each population). Then, we log10 normalized the data.

**Used the STEM: miner program:**

Settings - noramlized data, 100 profiles , no annotations

Results: top is high, middle is low, and the bottom is the comparison (high left, low right)

![](https://user-images.githubusercontent.com/4654474/53025987-0a749d80-3430-11e9-8f3b-5679eb674ac5.png)

**potential issue**: there are some time points for genes where the weight was zero, which might skew what profiles are significant. Try removing the zeros.

removing zeros makes no difference; but I did try scaling the data.

![](https://user-images.githubusercontent.com/4654474/53028715-65f55a00-3435-11e9-80ee-6d41be2af0e2.png)

When I take out the zeros and scale:

![](https://user-images.githubusercontent.com/4654474/53035489-8e845080-3443-11e9-9aff-4faa7196b4a8.png)

I think this is the best way to go. It gives a more accurate picture of the different types of shapes. The data ranged from 0 to 7000 when zeros left in, but when taken out, data ranged 5000-7000. The 0's may bias expression profiles that are low in abundance and mask effects between 5000-7000 strength.


------

<div id='id-section14'/>    

### Page 14: 2019-04-19.  Cerasi/pomonella brain transcriptome project: Organizing ideas   

Quick update on project: I'm trying to construct a story of the molecular architecture of diapause development. Diapause development is an alternative life history strategy that allows organisms to survive unfavorable conditions by suppressing metabolic rate and increase their stress hardiness. Mainly, there are 3 phases (Kostal et al. 2017): initiation, maintenance, and termination. Because diapause is dynamic, we need to measure gxp through time to capture the progression of phases. We want to compare 2 different species and their ability to shift their seasonal timing. Do they shift their seasonal time with the same molecular architecture? (Cerasi and Pomonella)

So far, I've analyzed cerasi- splitting classes of responses into population differences (population effect),  common (time effect), and divergent responses( time by population interaction; also main effect of time and population).

* we find major offsets in the opposite direction, such taht the earlier ecloser actually expresses sets of genes later, suggesting that they upregulate genes prior to termination.

I need to do the same for pomonella. So, far, we find a similar offset.

Some tables for future reference:

## Cerasi

Overall break down of diff expressed genes

| Source          | Significantly differentially expressed |
| --------------- | -------------------------------------- |
| Altitude        | 452                                    |
| Time            | 3014                                   |
| Altitude + Time | 58                                     |
| Altitude * Time | 14564                                  |

### Overall population level differences; WGCNA power 16, cutuff = .25, deepsplit = 4

Table of the number of genes per module

|Var1      | Freq|
|:---------|----:|
|grey      |    9|
|turquoise |  443|

Tables of relabelled names per module and their groupings

|color     |lett |module      |
|:---------|:----|:-----------|
|grey      |A    |MEgrey      |
|turquoise |B    |MEturquoise |

### Common responses ,  WGCNA power 16, cutuff = .25, deepsplit = 4

Table of the number of genes per module

|Var1          | Freq|
|:-------------|----:|
|black         |  127|
|brown         |  381|
|darkgreen     |   74|
|darkred       |  212|
|darkturquoise |   56|
|greenyellow   |  108|
|grey          |   32|
|grey60        |  355|
|lightyellow   |  261|
|magenta       |  433|
|midnightblue  |  102|
|royalblue     |   85|
|turquoise     |  788|

Tables of relabelled names per module and their groupings

|module          |class       |labs |
|:---------------|:-----------|:----|
|MEgreenyellow   |Cycling     |A    |
|MEgrey          |Cycling     |B    |
|MEdarkred       |Initiation  |C    |
|MEdarkgreen     |Maintenance |D    |
|MElightyellow   |Maintenance |E    |
|MEroyalblue     |Maintenance |F    |
|MEgrey60        |Maintenance |G    |
|MEmagenta       |Maintenance |H    |
|MEdarkturquoise |Maintenance |I    |
|MEmidnightblue  |Maintenance |J    |
|MEblack         |Maintenance |K    |
|MEbrown         |Termination |L    |
|MEturquoise     |Termination |M    |

### Divergent responses , WGCNA power 16, cutuff = .25, deepsplit = 4

Table of the number of genes per module

Var1           | Freq|
|:--------------|----:|
|blue4          | 1810|
|blueviolet     |   47|
|darkseagreen4  | 2442|
|darkviolet     |  165|
|grey           |    5|
|indianred3     | 5399|
|lightpink4     | 1781|
|mediumorchid   | 1790|
|orangered1     |   56|
|palevioletred2 |  207|
|thistle2       |   92|
|yellow4        |   95|

Tables of relabelled names per module and their groupings


|module           |cluster |laa |
|:----------------|:-------|:---|
|MEindianred3     |1       |A   |
|MEblue4          |2       |B   |
|MEmediumorchid   |2       |C   |
|MElightpink4     |2       |D   |
|MEorangered1     |2       |E   |
|MEdarkseagreen4  |3       |F   |
|MEpalevioletred2 |4       |G   |
|MEthistle2       |4       |H   |
|MEyellow4        |5       |I   |
|MEblueviolet     |5       |J   |
|MEdarkviolet     |5       |K   |
|MEgrey           |6       |L   |


## Pomonella

Overall break down of diff expressed genes

| Source          | Significantly differentially expressed |
| --------------- | -------------------------------------- |
| Population        | 0                                    |
| Time            | 2592                                   |
| Population + Time | 0                                     |
| Population x Time | 2902                                  |


### Common responses ,  WGCNA power 12, cutuff = .25, deepsplit = 4


Table of the number of genes per module
|Var1        | Freq|
|:-----------|----:|
|black       |  632|
|cyan        |   84|
|green       |  156|
|greenyellow |  103|
|grey        |    2|
|lightcyan   |  259|
|purple      | 1356|

Tables of relabelled names per module and their groupings

|module        |class       |lab |
|:-------------|:-----------|:---|
|MEgrey        |Cycling     |A   |
|MElightcyan   |Cycling     |B   |
|MEblack       |Initiation  |C   |
|MEcyan        |Maintenance |D   |
|MEgreenyellow |Maintenance |E   |
|MEgreen       |Termination |F   |
|MEpurple      |Termination |G   |

### Divergent responses , WGCNA power 12, cutuff = .25, deepsplit = 4   

Table of the number of genes per module

|Var1          | Freq|
|:-------------|----:|
|black         |  137|
|blue          |  279|
|brown         |  337|
|darkgrey      |  315|
|darkturquoise |   74|
|grey          |    2|
|grey60        |  153|
|purple        |  253|
|red           |  764|
|royalblue     |   83|
|turquoise     |  194|
|yellow        |  311|

Tables of relabelled names per module and their groupings

|module          |order |order2 |
|:---------------|:-----|:------|
|MEturquoise     |1     |A      |
|MEgrey60        |1     |B      |
|MEdarkturquoise |1     |C      |
|MEdarkgrey      |1     |D      |
|MEbrown         |2     |E      |
|MEyellow        |2     |F      |
|MEblack         |2     |G      |
|MEblue          |3     |H      |
|MEpurple        |4     |I      |
|MEred           |4     |J      |
|MEroyalblue     |4     |K      |

notes: the red module (J), has genes in the hippo, mtor, dorso-ventral  in kegg pathways, but not significant

# Introduction notes:
Set up drama about what organisms are doing in diapause-they have to be dormant, but also eventually have to be responsive to favorable cues


Especially in light of climate change, but species seem to be evolutionarily flexible

We know clinal variation SNPs associated with diapause and we know very well which genes may be important for diapause. However, missing gap in knowledge

Result punchline: Common responses have developmental and stress hardiness related genes; divergent responses are focused on growth related genes.

Insects need to be freeze avoiding or freeze tolerant (Bale and Hayward 2009)
Seasonal environments promote diapause (Bradford and Roff 1997)

Comparative studies of time course (heterochronic) are lacking

Rough sketch of paragraphs

1.	Life history timing is important, they differ especially in variable environments. For seasonal environments, organisms match their
2.	Timing is important especially for univoltine because they have a single window to get it right
3.	Diapause development- dynamic process,
4.	Molecular processes driving diapause development; end with Problem: we don’t know what genes are conserved vs which ones become adaptively modulated
5.	Rhagoletis system succinct
6.	In this study


Highly seasonal environments impose significant challenges for species persistence (). Although winter months appear depauperate of most living things, spring and summer months teem with species abundance and diversity (). Taken aside migration from warmer environments, how do species persist in situ during variable seasonal environments? For insects in temperate environments, they match the timing of life events with the seasons, which is under intense selection (). While the warm spring and summer months promote favorable growing conditions, fall signals insects to initiate dormancy or diapause which proceeds throughout the winter months in order to endure unfavorable growing conditions. Any mismatch between life history timing and seasonal change would lead to negative fitness consequences and subsequent population declines (Van Dyck et al. 2015). Populations constantly face critical life history decisions because seasonal environments themselves vary over space (latitude, longitude) and evolutionary time (Tauber & Tauber 1981).
The degree of selection is particularly strong for insect species with only one life cycle per year.
	Most pronounced over the harsh winter months
The ability to “know” how to proceed through life history transitions over the season…

Walk through the developmental diapause process.

Diapause development isn’t necessarily discrete and moves in a continuous fashion. The way development transitions depend on the transcriptional trajectories of genes through time. So just knowing differentially expressed genes misses the whole continuous process of diapause development.

-Issue, we ascribe and set up predefined groups already

-Specific tissues are not investigated

Need to add in this idea of the trajectory of diapause development is well characterized (Meyers et al. 2016- immediate termination process; Ragland et al. 2011; Ragland et al. 2010; Kostal et al. 2017) and focus on gene differences. What’s missing are comparative studies of transcriptomic profiling across diapause development to identify how organisms may adaptively differentiate their seasonal timing.

Large scale genomic divergence between ancestral and derived populations of Rhagoletis (Egan et al. 2015; Meredith paper; Powell et al. 2013).

Need statement: we need to understand gene identities but also their trajectories too. Because trajectories are an important component of their abundance and in turn, their role in any physiological process.

Predictions:
1.	Initiation: genes are important early on to start diapause development and then get turned off
2.	Maintenance: genes that play an important role contribute to homeostasis during dormancy or prolonged development; there are actually two general patterns
a.	U-shaped pattern would signify genes important for physiological processes during permissive conditions because gene abundance matches favorable conditions
b.	Hump-shaped patterns would signify genes turned on during dormancy and would be important for physiological processes during non-permissive conditions
3.	Termination: genes that abruptly or gradually turn on at the later stages of diapause development, we mainly expect genes to be enriched for resumption of growth




In this study, we aim to understand seasonal differences between two distinct population of Rhagoeltis cerasi by determining how these flies progress through diapause development using transcriptional trajectories as landmarks. We first determine the degree of seasonal population divergence in eclosion timing between two to four and a half months while in dormancy.  Over the same time course, we assess whether population level divergence in eclosion reflects differences in transcript abundance trajectories as well as transcript identity. For transcripts showing common responses, we expect them to fall into three discrete phases classes of diapause development (Kostal): Initiation, maintenance, and termination based on their pattern of expression over time. Out of the genes related to initiation, we expect genes to be enriched in metabolic suppression and slowdown of development (). Out of the genes related to maintenance, we expect genes to be enriched in stress hardiness pathways and perhaps lipid metabolism (). Out of the genes related to termination, we expect genes to be enriched in overall eye development, morphogenesis, and metabolic activation (). For genes displaying population differences across time, we expect to observe offsets in expression patterns that reflect their eclosion timing. For example, analyzing reaction norms may reveal peak expression values appearing earlier in lowland populations than highland populations. In order to determine whether these class of genes remain conserved or become adaptively modulated for common or divergent gene expression responses between populations, respectively, we compared gene sets and expression trajectories of Rhagoletis cerasi with Rhagoletis pomonella.


------

<div id='id-section15'/>    

### Page 15: 2019-05-01. Sorting ideas: How do we know the modules we're finding are robust?   

Recap: We used WGCNA to estimate weighted correlated gene networks. Nodes are the genes and the edges are weighted by the degree of correlation between the two nodes. From my understanding, WGCNA takes normalized gene expression data (in this case output of edgeR output, so normalized log fold change) and calculates all pairwise pearsons correlations. Converts this matrix (adjacency) to topological overlap matrix ; 1- TOM = dissimiliarity. Then cluster based on distances and given a cutoff, a group of genes in a cluster is a module.

Dan wants to know how we can tell that these modules don't arise by chance? In other words, are the modules robust? Are the modules real?  

I think there are two aspects of whether these modules are real: the number and the degree of genes cluster.  

1. the number of modules

2. the degree of genes ending up in a module

Dan is most interested in #2, but they're both related.

Ok, what are the different approaches?

### Are these modules assembling more than expected by chance?

  * Create a null distribution of random modules by permuting module labels and compare some test statistic from our module to the random distribution. This preserves the number of modules being compared, might be simpler.    

    * For each module, compare the degree of shared genes and determine if they're significantly different from empirical module.    


  * How consistent are the modules?   

    * bootstrap the samples and determine how often the same modules arise; ie determine network preservation

  * Determine the degree of module overlap between reference module to a randomly generated module (permutation). Compare reference with random generated module and their overalp with a fisher's exact test and determine whether the resultant log odds ratio is different from 1 - can use fisher's exact test. (overlap package, compares to the number of background genes)

  * Jack knife-  take one sample out, then estimate network and determine module preservation
    * tells you the influence of each sample


Some reference:

Good paper on zsummary and module preservation     
Li et al. 2015; Scientific Reports    
Title - Quantitative assessment of gene expression network module-validation methods    
link (https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4607977/#b57)  

Different way to assess modules : calculate median z scores   

Jia et al. 2012; Plos Computation Biology      
Title - Network-Assisted Investigation of Combined Causal
Signals from Genome-Wide Association Studies in Schizophrenia       
link (https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3390381/pdf/pcbi.1002587.pdf)     




### 2019-05-02 update- Workflow:

# Rationale

We want to know if the modules we've detected occur by random chance. To test this, we will permute gene names for the given module structure and for each module, ask how often are genes are shared between the reference set (empirically identified modules) and a random set (permuted). For each permuted dataset, we can determine the odds ratio of association (OR) and generate a distribution of OR across all permutations.

This is the set up for the contingency table: A can be the reference gene set, and B is the permuted gene set   

```R
`r knitr::kable(data.frame(notA=c("a","c"),inA=c("b","d"),row.names = c("notB","inB")))`
```

|     |notA |inA |
|:----|:----|:---|
|notB |a    |b   |
|inB  |c    |d   |


* OR <  1, then no association
* OR = 1, then equal association
* OR > 1, then positive assocation

Then for each module, we want to determine whether the log odds ratio distrubtion is signicantly different from 0 with a one sample t-test.

**Expected outcome**

If modules are assembling in a non-random pattern, we'd expect the logg odds distribution to be significantly less than 0.





------

<div id='id-section16'/>    

### Page 16:  

------

<div id='id-section17'/>    

### Page 17:  

------

<div id='id-section18'/>    

### Page 18:  

------

<div id='id-section19'/>    

### Page 19:  

------

<div id='id-section20'/>    

### Page 20:  

------

<div id='id-section21'/>    

### Page 21:  

------

<div id='id-section22'/>    

### Page 22:  

------

<div id='id-section23'/>    

### Page 23:  

------

<div id='id-section24'/>    

### Page 24:  

------

<div id='id-section25'/>    

### Page 25:  

------

<div id='id-section26'/>    

### Page 26:  

------

<div id='id-section27'/>    

### Page 27:  

------

<div id='id-section28'/>    

### Page 28:  

------

<div id='id-section29'/>    

### Page 29:  

------

<div id='id-section30'/>    

### Page 30:  

------

<div id='id-section31'/>    

### Page 31:  

------

<div id='id-section32'/>    

### Page 32:  

------

<div id='id-section33'/>    

### Page 33:  

------

<div id='id-section34'/>    

### Page 34:  

------

<div id='id-section35'/>    

### Page 35:  

------

<div id='id-section36'/>    

### Page 36:  

------

<div id='id-section37'/>    

### Page 37:  

------

<div id='id-section38'/>    

### Page 38:  

------

<div id='id-section39'/>    

### Page 39:  

------

<div id='id-section40'/>    

### Page 40:  

------

<div id='id-section41'/>    

### Page 41:  

------

<div id='id-section42'/>    

### Page 42:  

------

<div id='id-section43'/>    

### Page 43:  

------

<div id='id-section44'/>    

### Page 44:  

------

<div id='id-section45'/>    

### Page 45:  

------

<div id='id-section46'/>    

### Page 46:  

------

<div id='id-section47'/>    

### Page 47:  

------

<div id='id-section48'/>    

### Page 48:  

------

<div id='id-section49'/>    

### Page 49:  

------

<div id='id-section50'/>    

### Page 50:  

------

<div id='id-section51'/>    

### Page 51:  

------

<div id='id-section52'/>    

### Page 52:  

------

<div id='id-section53'/>    

### Page 53:  

------

<div id='id-section54'/>    

### Page 54:  

------

<div id='id-section55'/>    

### Page 55:  

------

<div id='id-section56'/>    

### Page 56:  

------

<div id='id-section57'/>    

### Page 57:  

------

<div id='id-section58'/>    

### Page 58:  

------

<div id='id-section59'/>    

### Page 59:  

------

<div id='id-section60'/>    

### Page 60:  

------

<div id='id-section61'/>    

### Page 61:  

------

<div id='id-section62'/>    

### Page 62:  

------

<div id='id-section63'/>    

### Page 63:  

------

<div id='id-section64'/>    

### Page 64:  

------

<div id='id-section65'/>    

### Page 65:  

------

<div id='id-section66'/>    

### Page 66:  

------

<div id='id-section67'/>    

### Page 67:  

------

<div id='id-section68'/>    

### Page 68:  

------

<div id='id-section69'/>    

### Page 69:  

------

<div id='id-section70'/>    

### Page 70:  

------

<div id='id-section71'/>    

### Page 71:  

------

<div id='id-section72'/>    

### Page 72:  

------

<div id='id-section73'/>    

### Page 73:  

------

<div id='id-section74'/>    

### Page 74:  

------

<div id='id-section75'/>    

### Page 75:  

------

<div id='id-section76'/>    

### Page 76:  

------

<div id='id-section77'/>    

### Page 77:  

------

<div id='id-section78'/>    

### Page 78:  

------

<div id='id-section79'/>    

### Page 79:  

------

<div id='id-section80'/>    

### Page 80:  

------

<div id='id-section81'/>    

### Page 81:  

------

<div id='id-section82'/>    

### Page 82:  

------

<div id='id-section83'/>    

### Page 83:  

------

<div id='id-section84'/>    

### Page 84:  

------

<div id='id-section85'/>    

### Page 85:  

------

<div id='id-section86'/>    

### Page 86:  

------

<div id='id-section87'/>    

### Page 87:  

------

<div id='id-section88'/>    

### Page 88:  

------

<div id='id-section89'/>    

### Page 89:  

------

<div id='id-section90'/>    

### Page 90:  

------

<div id='id-section91'/>    

### Page 91:  

------

<div id='id-section92'/>    

### Page 92:  

------

<div id='id-section93'/>    

### Page 93:  

------

<div id='id-section94'/>    

### Page 94:  

------

<div id='id-section95'/>    

### Page 95:  

------

<div id='id-section96'/>    

### Page 96:  

------

<div id='id-section97'/>    

### Page 97:  

------

<div id='id-section98'/>    

### Page 98:  

------

<div id='id-section99'/>    

### Page 99:  

------

<div id='id-section100'/>    

### Page 100:  

------

<div id='id-section101'/>    

### Page 101:  

------

<div id='id-section102'/>    

### Page 102:  

------

<div id='id-section103'/>    

### Page 103:  

------

<div id='id-section104'/>    

### Page 104:  

------

<div id='id-section105'/>    

### Page 105:  

------

<div id='id-section106'/>    

### Page 106:  

------

<div id='id-section107'/>    

### Page 107:  

------

<div id='id-section108'/>    

### Page 108:  

------

<div id='id-section109'/>    

### Page 109:  

------

<div id='id-section110'/>    

### Page 110:  

------

<div id='id-section111'/>    

### Page 111:  

------

<div id='id-section112'/>    

### Page 112:  

------

<div id='id-section113'/>    

### Page 113:  

------

<div id='id-section114'/>    

### Page 114:  

------

<div id='id-section115'/>    

### Page 115:  

------

<div id='id-section116'/>    

### Page 116:  

------

<div id='id-section117'/>    

### Page 117:  

------

<div id='id-section118'/>    

### Page 118:  

------

<div id='id-section119'/>    

### Page 119:  

------

<div id='id-section120'/>    

### Page 120:  

------

<div id='id-section121'/>    

### Page 121:  

------

<div id='id-section122'/>    

### Page 122:  

------

<div id='id-section123'/>    

### Page 123:  

------

<div id='id-section124'/>    

### Page 124:  

------

<div id='id-section125'/>    

### Page 125:  

------

<div id='id-section126'/>    

### Page 126:  

------

<div id='id-section127'/>    

### Page 127:  

------

<div id='id-section128'/>    

### Page 128:  

------

<div id='id-section129'/>    

### Page 129:  

------

<div id='id-section130'/>    

### Page 130:  

------

<div id='id-section131'/>    

### Page 131:  

------

<div id='id-section132'/>    

### Page 132:  

------

<div id='id-section133'/>    

### Page 133:  

------

<div id='id-section134'/>    

### Page 134:  

------

<div id='id-section135'/>    

### Page 135:  

------

<div id='id-section136'/>    

### Page 136:  

------

<div id='id-section137'/>    

### Page 137:  

------

<div id='id-section138'/>    

### Page 138:  

------

<div id='id-section139'/>    

### Page 139:  

------

<div id='id-section140'/>    

### Page 140:  

------

<div id='id-section141'/>    

### Page 141:  

------

<div id='id-section142'/>    

### Page 142:  

------

<div id='id-section143'/>    

### Page 143:  

------

<div id='id-section144'/>    

### Page 144:  

------

<div id='id-section145'/>    

### Page 145:  

------

<div id='id-section146'/>    

### Page 146:  

------

<div id='id-section147'/>    

### Page 147:  

------

<div id='id-section148'/>    

### Page 148:  

------

<div id='id-section149'/>    

### Page 149:  

------

<div id='id-section150'/>    

### Page 150:  

------

<div id='id-section151'/>    

### Page 151:  

------

<div id='id-section152'/>    

### Page 152:  

------

<div id='id-section153'/>    

### Page 153:  

------

<div id='id-section154'/>    

### Page 154:  

------

<div id='id-section155'/>    

### Page 155:  

------

<div id='id-section156'/>    

### Page 156:  

------

<div id='id-section157'/>    

### Page 157:  

------

<div id='id-section158'/>    

### Page 158:  

------

<div id='id-section159'/>    

### Page 159:  

------

<div id='id-section160'/>    

### Page 160:  

------

<div id='id-section161'/>    

### Page 161:  

------

<div id='id-section162'/>    

### Page 162:  

------

<div id='id-section163'/>    

### Page 163:  

------

<div id='id-section164'/>    

### Page 164:  

------

<div id='id-section165'/>    

### Page 165:  

------

<div id='id-section166'/>    

### Page 166:  

------

<div id='id-section167'/>    

### Page 167:  

------

<div id='id-section168'/>    

### Page 168:  

------

<div id='id-section169'/>    

### Page 169:  

------

<div id='id-section170'/>    

### Page 170:  

------

<div id='id-section171'/>    

### Page 171:  

------

<div id='id-section172'/>    

### Page 172:  

------

<div id='id-section173'/>    

### Page 173:  

------

<div id='id-section174'/>    

### Page 174:  

------

<div id='id-section175'/>    

### Page 175:  

------

<div id='id-section176'/>    

### Page 176:  

------

<div id='id-section177'/>    

### Page 177:  

------

<div id='id-section178'/>    

### Page 178:  

------

<div id='id-section179'/>    

### Page 179:  

------

<div id='id-section180'/>    

### Page 180:  

------

<div id='id-section181'/>    

### Page 181:  

------

<div id='id-section182'/>    

### Page 182:  

------

<div id='id-section183'/>    

### Page 183:  

------

<div id='id-section184'/>    

### Page 184:  

------

<div id='id-section185'/>    

### Page 185:  

------

<div id='id-section186'/>    

### Page 186:  

------

<div id='id-section187'/>    

### Page 187:  

------

<div id='id-section188'/>    

### Page 188:  

------

<div id='id-section189'/>    

### Page 189:  

------

<div id='id-section190'/>    

### Page 190:  

------

<div id='id-section191'/>    

### Page 191:  

------

<div id='id-section192'/>    

### Page 192:  

------

<div id='id-section193'/>    

### Page 193:  

------

<div id='id-section194'/>    

### Page 194:  

------

<div id='id-section195'/>    

### Page 195:  

------

<div id='id-section196'/>    

### Page 196:  

------

<div id='id-section197'/>    

### Page 197:  

------

<div id='id-section198'/>    

### Page 198:  

------

<div id='id-section199'/>    

### Page 199:  

------

<div id='id-section200'/>    

### Page 200:  
